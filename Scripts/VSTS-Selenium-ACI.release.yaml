apiVersion: 2018-06-01
location: centralus
properties:
  containers:
  - name: selenium-hub
    properties:
      image: selenium/hub
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
      ports:
        - port: 4442
        - port: 4443
        - port: 4444
      livenessProbe:
        httpGet:
          path: /wd/hub/status
          port: 4444
        initialDelaySeconds: 30
        timeoutSeconds: 5
      readinessProbe:
        httpGet:
          path: /wd/hub/status
          port: 4444
        initialDelaySeconds: 30
        timeoutSeconds: 5        
  - name: selenium-node
    properties:
      image: selenium/node-chrome
      environmentVariables:
        - name: SE_EVENT_BUS_HOST
          value: localhost
        - name: SE_EVENT_BUS_PUBLISH_PORT
          value: 4442
        - name: SE_EVENT_BUS_SUBSCRIBE_PORT     
          value: 4443
        - name: SE_NODE_PORT
          value: 5555    
        - name: SE_SCREEN_WIDTH
          value: 1366
        - name: SE_SCREEN_HEIGHT
          value: 768         
# SE_NODE_SESSION_TIMEOUT (in deconds)     
# https://webelement.click/en/selenium_grid_4_complete_guide_to_configuration_flags          
      ports:
        - port: 5555
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
      volumeMounts:
      - name: devshm
        mountPath: /dev/shm
      - name: downloads
        mountPath: /home/seluser/downloads          
  - name: selenium-firefox
    properties:
      image: selenium/node-firefox 
      environmentVariables:
        - name: SE_EVENT_BUS_HOST
          value: localhost
        - name: SE_EVENT_BUS_PUBLISH_PORT
          value: 4442
        - name: SE_EVENT_BUS_SUBSCRIBE_PORT     
          value: 4443
        - name: SE_NODE_PORT
          value: 5556
        - name: SE_SCREEN_WIDTH
          value: 1366
        - name: SE_SCREEN_HEIGHT
          value: 768         
# SE_NODE_SESSION_TIMEOUT (in deconds)     
# https://webelement.click/en/selenium_grid_4_complete_guide_to_configuration_flags
      ports:
        - port: 5556          
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
      volumeMounts:
      - name: devshm
        mountPath: /dev/shm
      - name: downloads
        mountPath: /home/seluser/downloads          
  - name: vsts-agent1
    properties:
      image: mcr.microsoft.com/azure-pipelines/vsts-agent:latest
      environmentVariables:
        - "name": "VSTS_AGENT"
          "value": "aci-a1"
        - "name": "VSTS_ACCOUNT"
          "value": "__VSTSAccount__"
        - "name": "VSTS_POOL"
          "value": "__VSTSPool__"
        - "name": "VSTS_TOKEN"
          "secureValue": "__VSTSToken__"
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
      volumeMounts:
        - name: downloads
          mountPath: /tmp/          
  - name: vsts-agent2
    properties:
      image: mcr.microsoft.com/azure-pipelines/vsts-agent:latest
      environmentVariables:
        - "name": "VSTS_AGENT"
          "value": "aci-a2"
        - "name": "VSTS_ACCOUNT"
          "value": "__VSTSAccount__"
        - "name": "VSTS_POOL"
          "value": "__VSTSPool__"
        - "name": "VSTS_TOKEN"
          "secureValue": "__VSTSToken__"
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
      volumeMounts:
        - name: downloads
          mountPath: /tmp/          
  volumes:
  - name: devshm
    emptyDir: {}
  - name: downloads
    emptyDir: {}
  ipAddress:
    type: Public
    ports:
    - protocol: tcp
      port: 4444
#    dnsNameLabel: selenium-hub
  osType: Linux
  restartPolicy: Always
tags: null
type: Microsoft.ContainerInstance/containerGroups
