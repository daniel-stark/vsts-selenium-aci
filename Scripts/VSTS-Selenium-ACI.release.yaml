apiVersion: 2018-06-01
location: centralus
properties:
  containers:
  - name: selenium-hub
    properties:
      image: selenium/hub
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
      ports:
        - containerPort: 4444
          protocol: TCP
  - name: selenium-node
    properties:
      image: selenium/node-chrome
      ports:
        - containerPort: 4444
          protocol: TCP
        - containerPort: 5555
          protocol: TCP
      volumeMounts:
        - mountPath: /dev/shm
          name: dshm
      environmentVariables:
        - "name": "HUB_HOST"
          "value": "selenium-hub"
        - "name": "HUB_PORT"
          "value": "4444"
        - "name": "NODE_PORT"
          "value": "5555"
        - "name": "SE_EVENT_BUS_HOST"
          "value": "selenium-hub"
        - name: HUB_PORT_4444_TCP_ADDR
          value: "selenium-hub"
        - name: HUB_PORT_4444_TCP_PORT
          value: "4444"          
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
  - name: selenium-firefox
    properties:
      image: selenium/node-firefox
      ports:
        - containerPort: 5556
      volumeMounts:
        - mountPath: /dev/shm
          name: dshm      
      environmentVariables:
        - "name": "HUB_HOST"
          "value": "selenium-hub"
        - "name": "HUB_PORT"
          "value": "4444"
        - "name": "NODE_PORT"
          "value": "5556"
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
  - name: vsts-agent1
    properties:
      image: mcr.microsoft.com/azure-pipelines/vsts-agent:latest
      environmentVariables:
        - "name": "VSTS_AGENT"
          "value": "aci-a1"
        - "name": "VSTS_ACCOUNT"
          "value": "__VSTSAccount__"
        - "name": "VSTS_POOL"
          "value": "__VSTSPool__"
        - "name": "VSTS_TOKEN"
          "secureValue": "__VSTSToken__"
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
  - name: vsts-agent2
    properties:
      image: mcr.microsoft.com/azure-pipelines/vsts-agent:latest
      environmentVariables:
        - "name": "VSTS_AGENT"
          "value": "aci-a2"
        - "name": "VSTS_ACCOUNT"
          "value": "__VSTSAccount__"
        - "name": "VSTS_POOL"
          "value": "__VSTSPool__"
        - "name": "VSTS_TOKEN"
          "secureValue": "__VSTSToken__"
      resources:
        requests:
          cpu: 0.5
          memoryInGb: 0.5
  osType: Linux
  restartPolicy: Always
tags: null
type: Microsoft.ContainerInstance/containerGroups
